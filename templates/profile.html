{% extends "base.html" %}

{% block title %}‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢ - CodeFitKub{% endblock %}

{% block extra_head %}
<style>
    .nav-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
        flex-wrap: wrap;
    }
    .tab-btn {
        flex: 1;
        min-width: 150px;
        padding: 15px 25px;
        background: white;
        border: none;
        border-radius: 10px;
        font-size: 1.1em;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .tab-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    .tab-btn.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .card {
        background: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 20px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    .form-group { margin-bottom: 20px; }
    label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: 600;
    }
    input, select, textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1em;
        transition: border-color 0.3s ease;
    }
    input:focus, select:focus, textarea:focus {
        outline: none;
        border-color: #667eea;
    }
    textarea {
        resize: vertical;
        min-height: 100px;
    }
    .btn {
        padding: 12px 30px;
        border: none;
        border-radius: 8px;
        font-size: 1.1em;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-right: 10px;
    }
    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102,126,234,0.4);
    }
    .btn-danger {
        background: #dc3545;
        color: white;
    }
    .btn-danger:hover { background: #c82333; }
    .btn-success {
        background: #28a745;
        color: white;
    }
    .btn-success:hover { background: #218838; }
    .exercise-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    .exercise-card {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        padding: 20px;
        border-radius: 12px;
        border-left: 5px solid #667eea;
        transition: transform 0.3s ease;
    }
    .exercise-card:hover { transform: translateX(5px); }
    .exercise-card h3 {
        color: #667eea;
        margin-bottom: 10px;
    }
    .exercise-card p {
        margin: 5px 0;
        color: #555;
    }
    .log-item {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 15px;
        border-left: 5px solid #28a745;
    }
    .log-item h4 {
        color: #667eea;
        margin-bottom: 10px;
    }
    .log-exercises {
        margin-top: 10px;
        padding-left: 20px;
    }
    .log-exercises li {
        margin: 5px 0;
        color: #555;
    }
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 25px;
        border-radius: 12px;
        text-align: center;
    }
    .stat-card h3 {
        font-size: 2.5em;
        margin-bottom: 10px;
    }
    .stat-card p {
        font-size: 1.1em;
        opacity: 0.9;
    }
    .exercise-form-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
    }
    @media (max-width: 768px) {
        .nav-tabs { flex-direction: column; }
        .tab-btn { width: 100%; }
        .exercise-list { grid-template-columns: 1fr; }
    }
</style>
{% endblock %}

{% block content %}
<h1>üí™ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢</h1>
<p class="subtitle">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢</p>

<div class="nav-tabs">
    <button class="tab-btn active" onclick="switchTab('exercises')">üèãÔ∏è ‡∏ó‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢</button>
    <button class="tab-btn" onclick="switchTab('programs')">üìã ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢</button>
    <button class="tab-btn" onclick="switchTab('log')">‚úèÔ∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á</button>
    <button class="tab-btn" onclick="switchTab('history')">üìä ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á</button>
</div>

<!-- ‡πÅ‡∏ó‡πá‡∏ö‡∏ó‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢ -->
<div id="exercises" class="tab-content active">
    <div class="card">
        <h2>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà</h2>
        <form id="exerciseForm" onsubmit="addExercise(event)">
            <div class="exercise-form-container">
                <div class="form-group">
                    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢ *</label>
                    <input type="text" id="exerciseName" required>
                </div>
                <div class="form-group">
                    <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó *</label>
                    <select id="exerciseType" required>
                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó --</option>
                        <option value="‡πÅ‡∏Ç‡∏ô">‡πÅ‡∏Ç‡∏ô</option>
                        <option value="‡∏Ç‡∏≤">‡∏Ç‡∏≤</option>
                        <option value="‡∏≠‡∏Å">‡∏≠‡∏Å</option>
                        <option value="‡∏´‡∏•‡∏±‡∏á">‡∏´‡∏•‡∏±‡∏á</option>
                        <option value="‡πÑ‡∏´‡∏•‡πà">‡πÑ‡∏´‡∏•‡πà</option>
                        <option value="‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡πâ‡∏≠‡∏á">‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡πâ‡∏≠‡∏á</option>
                        <option value="‡∏Ñ‡∏≤‡∏£‡πå‡∏î‡∏¥‡πÇ‡∏≠">‡∏Ñ‡∏≤‡∏£‡πå‡∏î‡∏¥‡πÇ‡∏≠</option>
                        <option value="‡∏¢‡∏∑‡∏î‡πÄ‡∏´‡∏¢‡∏µ‡∏¢‡∏î">‡∏¢‡∏∑‡∏î‡πÄ‡∏´‡∏¢‡∏µ‡∏¢‡∏î</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å *</label>
                    <select id="exerciseDifficulty" required>
                        <option value="‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</option>
                        <option value="‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á">‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option>
                        <option value="‡∏¢‡∏≤‡∏Å">‡∏¢‡∏≤‡∏Å</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢</label>
                <textarea id="exerciseDescription" placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ó‡πà‡∏≤‡∏ô‡∏µ‡πâ..."></textarea>
            </div>
            <button type="submit" class="btn btn-primary">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢</button>
        </form>
    </div>

    <div class="card">
        <h2>üìö ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢</h2>
        <div class="form-group">
            <label>‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
            <select id="filterType" onchange="filterExercises()">
                <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                <option value="‡πÅ‡∏Ç‡∏ô">‡πÅ‡∏Ç‡∏ô</option>
                <option value="‡∏Ç‡∏≤">‡∏Ç‡∏≤</option>
                <option value="‡∏≠‡∏Å">‡∏≠‡∏Å</option>
                <option value="‡∏´‡∏•‡∏±‡∏á">‡∏´‡∏•‡∏±‡∏á</option>
                <option value="‡πÑ‡∏´‡∏•‡πà">‡πÑ‡∏´‡∏•‡πà</option>
                <option value="‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡πâ‡∏≠‡∏á">‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡πâ‡∏≠‡∏á</option>
                <option value="‡∏Ñ‡∏≤‡∏£‡πå‡∏î‡∏¥‡πÇ‡∏≠">‡∏Ñ‡∏≤‡∏£‡πå‡∏î‡∏¥‡πÇ‡∏≠</option>
                <option value="‡∏¢‡∏∑‡∏î‡πÄ‡∏´‡∏¢‡∏µ‡∏¢‡∏î">‡∏¢‡∏∑‡∏î‡πÄ‡∏´‡∏¢‡∏µ‡∏¢‡∏î</option>
            </select>
        </div>
        <div id="exerciseList" class="exercise-list"></div>
    </div>
</div>

<!-- ‡πÅ‡∏ó‡πá‡∏ö‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢ -->
<div id="programs" class="tab-content">
    <div class="card">
        <h2>‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢</h2>
        <form id="programForm" onsubmit="addProgram(event)">
            <div class="form-group">
                <label>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° *</label>
                <input type="text" id="programName" required>
            </div>
            <div class="form-group">
                <label>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå</label>
                <select id="programGoal">
                    <option value="‡∏•‡∏î‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å">‡∏•‡∏î‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</option>
                    <option value="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠</option>
                    <option value="‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á">‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á</option>
                    <option value="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏î‡∏ó‡∏ô">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏î‡∏ó‡∏ô</option>
                    <option value="‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô</option>
                </select>
            </div>
            <div class="form-group">
                <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢ (‡∏Å‡∏î Ctrl ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏ó‡πà‡∏≤)</label>
                <select id="programExercises" multiple size="8" style="height: auto;"></select>
            </div>
            <div class="form-group">
                <label>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°</label>
                <textarea id="programDescription"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°</button>
        </form>
    </div>

    <div class="card">
        <h2>üìã ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà</h2>
        <div id="programList" class="exercise-list"></div>
    </div>
</div>

<!-- ‡πÅ‡∏ó‡πá‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á -->
<div id="log" class="tab-content">
    <div class="card">
        <h2>‚úèÔ∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h2>
        <form id="logForm" onsubmit="addWorkoutLog(event)">
            <div class="form-group">
                <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å *</label>
                <select id="logMember" required>
                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å --</option>
                </select>
                <button type="button" class="btn btn-success" style="margin-top: 10px;" onclick="addNewMember()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà</button>
            </div>

            <div class="form-group">
                <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢ *</label>
                <input type="date" id="logDate" required>
            </div>

            <div class="form-group">
                <label>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ (‡∏ô‡∏≤‡∏ó‡∏µ) *</label>
                <input type="number" id="logDuration" min="1" required>
            </div>

            <div class="form-group">
                <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                <select id="logProgram">
                    <option value="">-- ‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° --</option>
                </select>
            </div>

            <div class="form-group">
                <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ó‡∏≥ *</label>
                <div id="logExercisesContainer"></div>
            </div>

            <div class="form-group">
                <label>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
                <textarea id="logNotes" placeholder="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å, ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô, ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö..."></textarea>
            </div>

            <button type="submit" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á</button>
        </form>
    </div>
</div>

<!-- ‡πÅ‡∏ó‡πá‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ -->
<div id="history" class="tab-content">
    <div class="card">
        <h2>üìä ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</h2>
        <div class="form-group">
            <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</label>
            <select id="historyMember" onchange="showMemberHistory()">
                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å --</option>
            </select>
        </div>
    </div>

    <div id="statsContainer"></div>
    <div id="historyContainer"></div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    let exercises = [];
    let programs = [];
    let workoutLogs = [];
    let members = ['‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å 1', '‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å 2', '‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å 3'];

    window.onload = function() {
        loadSampleData();
        updateExerciseList();
        updateProgramList();
        updateMemberSelects();
        updateLogExercises();
        updateProgramExercisesSelect();
        document.getElementById('logDate').valueAsDate = new Date();
    };

    function loadSampleData() {
        exercises = [
            {id: 1, name: '‡∏ß‡∏¥‡∏î‡∏û‡∏∑‡πâ‡∏ô', type: '‡∏≠‡∏Å', difficulty: '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô', description: '‡∏ß‡∏¥‡∏î‡∏û‡∏∑‡πâ‡∏ô‡πÅ‡∏ö‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏≠‡∏Å'},
            {id: 2, name: '‡∏ã‡∏¥‡∏ó‡∏≠‡∏±‡∏û', type: '‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡πâ‡∏≠‡∏á', difficulty: '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô', description: '‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡πâ‡∏≠‡∏á'},
            {id: 3, name: '‡∏™‡∏Ñ‡∏ß‡∏≠‡∏ï', type: '‡∏Ç‡∏≤', difficulty: '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á', description: '‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡∏∞‡πÇ‡∏û‡∏Å'},
            {id: 4, name: '‡∏ß‡∏¥‡πà‡∏á‡πÄ‡∏´‡∏¢‡∏≤‡∏∞', type: '‡∏Ñ‡∏≤‡∏£‡πå‡∏î‡∏¥‡πÇ‡∏≠', difficulty: '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô', description: '‡∏ß‡∏¥‡πà‡∏á‡πÄ‡∏´‡∏¢‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏à‡∏∏‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡∏±‡∏ß‡πÉ‡∏à'},
            {id: 5, name: '‡∏î‡∏±‡∏°‡πÄ‡∏ö‡∏•‡πÄ‡∏Ñ‡∏¥‡∏£‡πå‡∏•', type: '‡πÅ‡∏Ç‡∏ô', difficulty: '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á', description: '‡∏¢‡∏Å‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠ biceps ‡∏î‡πâ‡∏ß‡∏¢‡∏î‡∏±‡∏°‡πÄ‡∏ö‡∏•'}
        ];

        programs = [
            {id: 1, name: '‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏•‡∏î‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å', goal: '‡∏•‡∏î‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å', exercises: [1, 2, 4], description: '‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏î‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å'},
            {id: 2, name: '‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠', goal: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠', exercises: [1, 3, 5], description: '‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏ó‡∏±‡πà‡∏ß‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢'}
        ];

        workoutLogs = [
            {id: 1, member: '‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å 1', date: '2025-10-01', duration: 45, exercises: [{id:1,sets:3,reps:10,weight:0},{id:2,sets:3,reps:15,weight:0},{id:4,sets:1,reps:10,weight:0}], notes: '‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏î‡∏µ ‡∏°‡∏µ‡∏û‡∏•‡∏±‡∏á', programId: 1},
            {id: 2, member: '‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å 1', date: '2025-10-03', duration: 50, exercises: [{id:1,sets:3,reps:12,weight:0},{id:3,sets:3,reps:12,weight:20},{id:5,sets:3,reps:10,weight:5}], notes: '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏ß‡∏î‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏ö‡πâ‡∏≤‡∏á', programId: 2}
        ];
    }

    function switchTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');
        event.target.classList.add('active');
        if(tabName === 'history') showMemberHistory();
    }

    function addExercise(e) {
        e.preventDefault();
        exercises.push({
            id: Date.now(),
            name: document.getElementById('exerciseName').value,
            type: document.getElementById('exerciseType').value,
            difficulty: document.getElementById('exerciseDifficulty').value,
            description: document.getElementById('exerciseDescription').value
        });
        updateExerciseList();
        updateLogExercises();
        updateProgramExercisesSelect();
        document.getElementById('exerciseForm').reset();
        alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‚úÖ');
    }

    function updateExerciseList() {
        const filterType = document.getElementById('filterType')?.value || '';
        const filtered = filterType ? exercises.filter(ex => ex.type === filterType) : exercises;
        document.getElementById('exerciseList').innerHTML = filtered.map(ex => `
            <div class="exercise-card">
                <h3>üèãÔ∏è ${ex.name}</h3>
                <p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</strong> ${ex.type}</p>
                <p><strong>‡∏£‡∏∞‡∏î‡∏±‡∏ö:</strong> ${ex.difficulty}</p>
                <p>${ex.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢'}</p>
                <button class="btn btn-danger" style="margin-top: 10px;" onclick="deleteExercise(${ex.id})">üóëÔ∏è ‡∏•‡∏ö</button>
            </div>
        `).join('') || '<p style="text-align: center; padding: 20px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ó‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢</p>';
    }

    function filterExercises() { updateExerciseList(); }

    function deleteExercise(id) {
        if(confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ó‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
            exercises = exercises.filter(ex => ex.id !== id);
            updateExerciseList();
            updateLogExercises();
            updateProgramExercisesSelect();
        }
    }

    function addProgram(e) {
        e.preventDefault();
        const selected = Array.from(document.getElementById('programExercises').selectedOptions).map(o => parseInt(o.value));
        if(selected.length === 0) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ó‡πà‡∏≤');
        
        programs.push({
            id: Date.now(),
            name: document.getElementById('programName').value,
            goal: document.getElementById('programGoal').value,
            exercises: selected,
            description: document.getElementById('programDescription').value
        });
        updateProgramList();
        updateLogProgramSelect();
        document.getElementById('programForm').reset();
        alert('‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‚úÖ');
    }

    function updateProgramList() {
        document.getElementById('programList').innerHTML = programs.map(p => `
            <div class="exercise-card">
                <h3>üìã ${p.name}</h3>
                <p><strong>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå:</strong> ${p.goal}</p>
                <p><strong>‡∏ó‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢:</strong> ${p.exercises.map(id => exercises.find(e => e.id === id)?.name || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•').join(', ')}</p>
                <p>${p.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢'}</p>
                <button class="btn btn-danger" style="margin-top: 10px;" onclick="deleteProgram(${p.id})">üóëÔ∏è ‡∏•‡∏ö</button>
            </div>
        `).join('') || '<p style="text-align: center; padding: 20px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°</p>';
    }

    function deleteProgram(id) {
        if(confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
            programs = programs.filter(p => p.id !== id);
            updateProgramList();
            updateLogProgramSelect();
        }
    }

    function updateProgramExercisesSelect() {
        document.getElementById('programExercises').innerHTML = exercises.map(ex => 
            `<option value="${ex.id}">${ex.name} (${ex.type})</option>`
        ).join('');
    }

    function updateMemberSelects() {
        ['logMember', 'historyMember'].forEach(id => {
            const sel = document.getElementById(id);
            const val = sel.value;
            sel.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å --</option>' + members.map(m => `<option value="${m}">${m}</option>`).join('');
            if(val) sel.value = val;
        });
    }

    function addNewMember() {
        const name = prompt('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà:');
        if(name && name.trim()) {
            members.push(name.trim());
            updateMemberSelects();
            alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‚úÖ');
        }
    }

    function updateLogExercises() {
        document.getElementById('logExercisesContainer').innerHTML = exercises.map(ex => `
            <div style="margin: 8px 0;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="logExercises" value="${ex.id}" style="width: auto; margin-right: 10px;">
                    ${ex.name} (${ex.type})
                </label>
                <div style="margin-left: 30px; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 5px;">
                    <input type="number" placeholder="‡πÄ‡∏ã‡πá‡∏ï" min="1" id="sets_${ex.id}" style="padding: 5px;">
                    <input type="number" placeholder="‡∏Ñ‡∏£‡∏±‡πâ‡∏á/‡πÄ‡∏ã‡πá‡∏ï" min="1" id="reps_${ex.id}" style="padding: 5px;">
                    <input type="number" placeholder="‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (kg)" min="0" step="0.5" id="weight_${ex.id}" style="padding: 5px;">
                </div>
            </div>
        `).join('');
    }

    function updateLogProgramSelect() {
        document.getElementById('logProgram').innerHTML = '<option value="">-- ‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° --</option>' +
            programs.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
    }

    function addWorkoutLog(e) {
        e.preventDefault();
        const member = document.getElementById('logMember').value;
        if(!member) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å');

        const selected = Array.from(document.querySelectorAll('input[name="logExercises"]:checked')).map(cb => ({
            id: parseInt(cb.value),
            sets: document.getElementById(`sets_${cb.value}`)?.value || 0,
            reps: document.getElementById(`reps_${cb.value}`)?.value || 0,
            weight: document.getElementById(`weight_${cb.value}`)?.value || 0
        }));

        if(selected.length === 0) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ó‡πà‡∏≤');

        workoutLogs.push({
            id: Date.now(),
            member: member,
            date: document.getElementById('logDate').value,
            duration: parseInt(document.getElementById('logDuration').value),
            exercises: selected,
            programId: document.getElementById('logProgram').value ? parseInt(document.getElementById('logProgram').value) : null,
            notes: document.getElementById('logNotes').value
        });

        document.getElementById('logForm').reset();
        document.getElementById('logDate').valueAsDate = new Date();
        updateLogExercises();
        alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‚úÖ');
    }

    function showMemberHistory() {
        const member = document.getElementById('historyMember').value;
        if(!member) {
            document.getElementById('statsContainer').innerHTML = '';
            document.getElementById('historyContainer').innerHTML = '';
            return;
        }

        const logs = workoutLogs.filter(l => l.member === member);
        if(logs.length === 0) {
            document.getElementById('statsContainer').innerHTML = '';
            document.getElementById('historyContainer').innerHTML = '<div class="card"><p style="text-align: center; padding: 20px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢</p></div>';
            return;
        }

        const totalWorkouts = logs.length;
        const totalMinutes = logs.reduce((s, l) => s + l.duration, 0);
        const exCount = {};
        logs.forEach(l => l.exercises.forEach(ex => exCount[ex.id] = (exCount[ex.id] || 0) + 1));
        const mostPopular = Object.keys(exCount).length > 0 ? exercises.find(e => e.id == Object.keys(exCount).reduce((a, b) => exCount[a] > exCount[b] ? a : b))?.name || '-' : '-';

        document.getElementById('statsContainer').innerHTML = `
            <div class="stats-grid">
                <div class="stat-card"><h3>${totalWorkouts}</h3><p>‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p></div>
                <div class="stat-card"><h3>${totalMinutes}</h3><p>‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p></div>
                <div class="stat-card"><h3>${Math.round(totalMinutes / totalWorkouts)}</h3><p>‡∏ô‡∏≤‡∏ó‡∏µ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p></div>
                <div class="stat-card"><h3 style="font-size: 1.5em;">${mostPopular}</h3><p>‡∏ó‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏ö‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</p></div>
            </div>
        `;

        document.getElementById('historyContainer').innerHTML = `
            <div class="card">
                <h2>üìù ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢</h2>
                <div class="workout-log">
                    ${logs.sort((a, b) => new Date(b.date) - new Date(a.date)).map(log => {
                        const prog = log.programId ? programs.find(p => p.id === log.programId) : null;
                        return `
                            <div class="log-item">
                                <h4>üìÖ ${new Date(log.date).toLocaleDateString('th-TH', {year: 'numeric', month: 'long', day: 'numeric'})} - ‚è±Ô∏è ${log.duration} ‡∏ô‡∏≤‡∏ó‡∏µ</h4>
                                ${prog ? `<p><strong>‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°:</strong> ${prog.name}</p>` : ''}
                                <p><strong>‡∏ó‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ó‡∏≥:</strong></p>
                                <ul class="log-exercises">
                                    ${log.exercises.map(ex => {
                                        const exercise = exercises.find(e => e.id === ex.id);
                                        const details = [];
                                        if(ex.sets > 0) details.push(`${ex.sets} ‡πÄ‡∏ã‡πá‡∏ï`);
                                        if(ex.reps > 0) details.push(`${ex.reps} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á`);
                                        if(ex.weight > 0) details.push(`${ex.weight} kg`);
                                        return `<li>${exercise?.name || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏ä‡∏∑‡πà‡∏≠'}${details.length > 0 ? ' - ' + details.join(', ') : ''}</li>`;
                                    }).join('')}
                                </ul>
                                ${log.notes ? `<p><strong>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:</strong> ${log.notes}</p>` : ''}
                                <button class="btn btn-danger" style="margin-top: 10px;" onclick="deleteLog(${log.id})">üóëÔ∏è ‡∏•‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                            </div>
                        `;
                    }).join('')}
                </div>
            </div>
        `;
    }

    function deleteLog(id) {
        if(confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
            workoutLogs = workoutLogs.filter(l => l.id !== id);
            showMemberHistory();
            alert('‡∏•‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‚úÖ');
        }
    }
</script>
{% endblock %}